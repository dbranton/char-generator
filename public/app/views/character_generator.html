<!--<div id="info_contents">-->
<!--<?php $is_logged_in = ($logged_in) ? 'true' : 'false'; ?>-->

<div id="charGenApp" class="form-horizontal" ng-init="init()" ng-cloak>
    <h3>Character Generator</h3>
    <!--<span class="hide">{{isLoggedIn=<?php echo $is_logged_in; ?>}}</span>-->
    <span ng-hide="true">Loading Character Generator...</span>
    <div id="successMsg" class="alert alert-success" ng-show="successMessage">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <p>{{successMessage}}</p>
    </div>
    <div class="alert alert-danger" ng-show="errorMessage">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <div ng-bind-html="errorMessage"></div>
    </div>
    <div class="row panel panel-default">
    <div class="panel-heading">
        <div class="pull-left">
            <button class="btn btn-primary" ng-click="openNewCharDialog()">Create New Character</button>
        </div>
        <div class="pull-right" ng-show="storedCharacter">
            Last Stored Character: <button type="button" class="btn btn-default" ng-click="fillInCharacter()">{{storedCharacter.name}}</button>
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="panel-body">
    <div class="col-md-6" id="charGenCol1">
    <fieldset>
        <legend>Background</legend> <!--data-target="#backgroundPanel" data-toggle="collapse"-->
        <div id="backgroundPanel" class="collapse in">
            <div class="form-group">
                <label class="col-sm-4 control-label">Name:</label>
                <div class="col-sm-8">
                    <input type="text" class="form-control" ng-model="character.name"> <!--placeholder="Pick a Name..."-->
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label">Race:</label>
                <div class="col-sm-8">
                    <div class="input-group">
                        <label class="input-group-addon btn btn-default" ng-click="openRaceDialog()">
                            <span class="fa fa-columns"></span>
                        </label>
                        <ui-select ng-model="character.raceObj"
                                   ng-change="broadcastObj(raceData, character.raceObj.name, 'race')"
                                   theme="select2"
                                   reset-search-input="false"
                                   style="width: 100%;">
                            <ui-select-match placeholder="Select a race">{{$select.selected.name}}</ui-select-match>
                            <ui-select-choices repeat="race in raceData | filter: {name: $select.search}">
                                <div ng-bind-html="race.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label">Background:</label>
                <div class="col-sm-8">
                    <div class="input-group">
                        <label class="input-group-addon btn btn-default" ng-click="openBackgroundDialog()">
                            <span class="fa fa-columns"></span>
                        </label>
                        <ui-select ng-model="character.background"
                                   ng-change="broadcastObj(backgroundData, character.background.name, 'background')"
                                   theme="select2"
                                   reset-search-input="false"
                                   style="width: 100%;">
                            <ui-select-match placeholder="Select a background">{{$select.selected.name}}</ui-select-match>
                            <ui-select-choices repeat="background in backgroundData | filter: {name: $select.search}">
                                <div ng-bind-html="background.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
            <div class="form-group" ng-if="character.raceObj.bonusAbilities">
                <label class="col-sm-4 control-label">Bonus Abilities:</label>
                <div class="col-sm-8">
                    <ui-select id="bonusRaceAbilities"
                               multiple
                               max="2"
                               ng-model="selectedBonusAbilities"
                               bonus-ability
                               theme="select2"
                               style="width: 100%;">
                        <ui-select-match placeholder="Pick your bonus abilities">{{$item.name}}</ui-select-match>
                        <ui-select-choices repeat="ability in character.raceObj.bonusAbilities | filter: {name: $select.search}">
                            <div ng-bind-html="ability.name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group" ng-if="character.raceObj.spellcasting.classId">
                <label class="col-sm-4 control-label">Bonus Cantrip:</label>
                <div class="col-sm-8">
                    <!--<div class="text" ng-hide="character.raceObj.cantrips">{{character.raceObj.cantrip}}</div>-->
                    <div class="input-group">
                        <!--<label class="input-group-addon btn btn-default" ng-click="openBonusCantripDialog(character.raceObj.spellcasting)">
                            <span class="fa fa-columns"></span>
                        </label>-->
                        <spell-dialog ng-model="character.raceObj.cantrip" list="bonusRaceCantrips"
                                      select2-spellcasting="character.raceObj.spellcasting"></spell-dialog>
                        <ui-select id="bonusRaceCantrip"
                                   multiple
                                   max="1"
                                   ng-model="character.raceObj.cantrip"
                                   select2-spellcasting="character.raceObj.spellcasting"
                                   list="bonusRaceCantrips"
                                   theme="select2"
                                   style="width: 100%;">
                            <ui-select-match placeholder="Pick your bonus cantrip">{{$item.name}}</ui-select-match>
                            <ui-select-choices repeat="cantrip in $parent.bonusRaceCantripsFiltered = (bonusRaceCantrips | filterSpells: character.classObj.selectedCantrips)
                                                    | filter: {name: $select.search} | filterSpells: character.classObj.selectedCantrips"
                                               refresh="refreshSpells($select.search)"
                                               refresh-delay="500">
                                <div ng-bind-html="cantrip.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
        </div>
    </fieldset>
    <fieldset>
        <legend>Class</legend>
        <div collapse="!character.raceObj.name || !character.background.name">
            <div class="form-group">
                <label class="col-sm-4 control-label">Level:</label>
                <div class="col-sm-8">
                    <ui-select ng-model="character.level"
                               ng-change="changeLevel(character.level)"
                               theme="select2"
                               search-enabled="false"
                               reset-search-input="false"
                               style="width: 100%;">
                        <ui-select-match placeholder="Select a level">{{$select.selected}}</ui-select-match>
                        <ui-select-choices repeat="level in levels | filter: $select.search">
                            <div ng-bind-html="level | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 control-label">Class:</label>
                <div class="col-sm-8">
                    <div class="input-group">
                        <label class="input-group-addon btn btn-default" ng-click="openClassDialog()">
                            <span class="fa fa-columns"></span>
                        </label>
                        <ui-select ng-model="character.classObj"
                                   ng-change="broadcastObj(classData, character.classObj.name, 'clazz')"
                                   theme="select2"
                                   reset-search-input="false"
                                   style="width: 100%;">
                            <ui-select-match placeholder="Select a class">{{$select.selected.name}}</ui-select-match>
                            <ui-select-choices repeat="class in classData | filter: {name: $select.search}">
                                <div ng-bind-html="class.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
            <div class="form-group" ng-show="character.classObj.subclasses.length > 0 || character.classObj.subclassObj">
                <label class="col-sm-4 control-label">{{character.classObj.subclassName}}:</label>
                <div class="col-sm-8">
                    <div class="input-group">
                        <label class="input-group-addon btn btn-default" ng-click="openSubclassDialog()">
                            <span class="fa fa-columns"></span>
                        </label>
                        <ui-select ng-model="character.classObj.subclassObj"
                                   ng-change="broadcastObj(character.classObj.subclasses, character.classObj.subclassObj.name, 'subclass')"
                                   theme="select2"
                                   reset-search-input="false"
                                   style="width: 100%;">
                            <ui-select-match placeholder="Select a subclass">{{$select.selected.name}}</ui-select-match>
                            <ui-select-choices repeat="subclassObj in character.classObj.subclasses | filter: {name: $select.search}">
                                <div ng-bind-html="subclassObj.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
            <!-- for Class-based feature choices (ex: Fighting Style, Metamagic) -->
            <div class="form-group" ng-repeat="selectedFeature in character.classObj.selectedFeatures">
                <label class="col-sm-4 control-label">{{selectedFeature.label}}:</label> <!--Feature:</label>-->
                <div class="col-sm-8">
                    <div class="input-group">
                        <label class="input-group-addon btn btn-default" ng-click="openFeatureDialog(selectedFeature, 'classArr')">
                            <span class="fa fa-columns"></span>
                        </label>
                        <ui-select multiple ng-model="selectedFeature.name"
                                   max="{{selectedFeature.max}}"
                                   ng-change="broadcastArray(selectedFeature, 'selectedFeatures', 'classArr')"
                                   theme="select2"
                                   style="width: 100%;">
                            <ui-select-match placeholder="Select a feature">{{$item.name}}</ui-select-match>
                            <ui-select-choices repeat="feature in selectedFeature.choices | filter: {name: $select.search}">
                                <div ng-bind-html="feature.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
            <!-- for subclass feature choices (ex: Totem Aspect, Combat Superiority, etc.) -->
            <div class="form-group" ng-repeat="selectedFeature in character.classObj.subclassObj.selectedFeatures">
                <label class="col-sm-4 control-label">{{selectedFeature.label}}:</label> <!--Feature:</label>-->
                <div class="col-sm-8">
                    <div class="input-group">
                        <label class="input-group-addon btn btn-default" ng-click="openFeatureDialog(selectedFeature, 'subclassArr')">
                            <span class="fa fa-columns"></span>
                        </label>
                        <ui-select multiple ng-model="selectedFeature.name"
                                   max="{{selectedFeature.max}}"
                                   ng-change="broadcastArray(selectedFeature, 'selectedFeatures', 'subclassArr')"
                                   theme="select2"
                                   style="width: 100%;">
                            <ui-select-match placeholder="Select a feature">{{$item.name}}</ui-select-match>
                            <ui-select-choices repeat="feature in selectedFeature.choices">
                                <div ng-bind-html="feature.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
            <div class="form-group" ng-show="character.classObj.cantrip">
                <label class="col-sm-4 control-label">Cantrips:</label>
                <div class="col-sm-8">
                    <div class="input-group">
                        <!--<label class="input-group-addon btn btn-default" ng-click="openCantripDialog()">
                            <span class="fa fa-columns"></span>
                        </label>
                        <select ui-select2 ng-model="character.classObj.selectedCantrips" id="chosenCantrips" multiple max="{{character.classObj.numCantrips}}" style="width: 100%" ng-change="broadcastNonObj(character.classObj.selectedCantrips, 'selectedCantrips')">
                            <option ng-repeat="cantrip in character.classObj.cantrips">{{cantrip.name}}</option>
                        </select>-->
                        <spell-dialog ng-model="character.classObj.selectedCantrips" list="classCantrips"
                                      select2-spellcasting="character.classObj.cantrip"></spell-dialog>
                        <ui-select ng-model="character.classObj.selectedCantrips"
                                   multiple
                                   list="classCantrips"
                                   max="{{character.classObj.cantrip.numSpellsKnown}}"
                                   bonus-cantrip="{{character.classObj.cantrip.bonusCantrip}}"
                                   select2-spellcasting="character.classObj.cantrip"
                                   theme="select2"
                                   style="width: 100%;">
                            <ui-select-match placeholder="Pick your cantrips" ui-lock-choice="$item.disabled">{{$item.name}}</ui-select-match>
                            <ui-select-choices repeat="cantrip in $parent.classCantripsFiltered = (classCantrips | filterSpells: character.raceObj.cantrip)
                                                | filter: {name: $select.search} | filterSpells: character.raceObj.cantrip"
                                               refresh="refreshSpells($select.search)"
                                               refresh-delay="500">
                                <div ng-bind-html="cantrip.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
            <!-- subclass cantrips -->
            <div class="form-group" ng-show="character.classObj.subclassObj.cantrips">
                <label class="col-sm-4 control-label">Cantrips:</label>
                <div class="col-sm-8">
                    <div class="input-group">
                        <!--<label class="input-group-addon btn btn-default" ng-click="openSubclassCantripDialog()">
                            <span class="fa fa-columns"></span>
                        </label>
                        <select ui-select2 ng-model="character.classObj.selectedCantrips" id="chosenSubclassCantrips" multiple max="{{character.classObj.numCantrips}}" style="width: 100%" ng-change="broadcastNonObj(character.classObj.selectedCantrips, 'selectedCantrips')">
                            <option ng-repeat="cantrip in character.classObj.subclassObj.cantrips">{{cantrip.name}}</option>
                        </select>-->
                        <!--<spell-dialog spell-obj="character.classObj.spellcasting" ng-model="character.classObj.selectedCantrips"></spell-dialog>
                        <ui-select ng-model="character.classObj.selectedCantrips"
                                   multiple
                                   list="classSpells"
                                   max="{{character.classObj.numCantrips}}"
                                   select2-spellcasting="character.classObj.spellcasting"
                                   bonus="bonusSelectedSpells"
                                   theme="select2"
                                   style="width: 100%;">
                            <ui-select-match placeholder="Pick your spells">{{$item.name}}</ui-select-match>
                            <ui-select-choices group-by="'level_desc'"
                                               repeat="spell in classSpells track by $index"
                                               refresh="refreshSpells($select.search)"
                                               refresh-delay="500">
                                <div ng-bind-html="spell.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>-->
                    </div>
                </div>
            </div>
            <div class="form-group" ng-show="character.classObj.spellcasting.numSpellsKnown">
                <label class="col-sm-4 control-label">Spells:</label>
                <div class="col-sm-8">
                    <div class="input-group">
                        <!--<label class="input-group-addon btn btn-default" ng-click="openSpellDialog(character.classObj.spellcasting)">
                            <span class="fa fa-columns"></span>
                        </label>-->
                        <spell-dialog ng-model="character.classObj.selectedSpells" list="classSpells"
                                      select2-spellcasting="character.classObj.spellcasting"></spell-dialog>
                        <ui-select ng-model="character.classObj.selectedSpells"
                                   multiple
                                   list="classSpells"
                                   max="{{character.classObj.spellcasting.numSpellsKnown}}"
                                   select2-spellcasting="character.classObj.spellcasting"
                                   theme="select2"
                                   style="width: 100%;">
                            <ui-select-match placeholder="Pick your spells">{{$item.name}}</ui-select-match>
                            <ui-select-choices group-by="'level_desc'"
                                               repeat="spell in $parent.classSpellsFiltered = (classSpells | filterSpells: character.classObj.spellcasting.bonusSelectedSpells)
                                                | filter: {name: $select.search} | filterSpells: character.classObj.spellcasting.bonusSelectedSpells"
                                               refresh="refreshSpells($select.search)"
                                               refresh-delay="500">
                                <div ng-bind-html="spell.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
            <!-- commented out until i figure out how to deal with it -->
            <div class="form-group" ng-show="character.classObj.spellcasting.bonus.numSpellsKnown">
                <label class="col-sm-4 control-label">Bonus Spells:</label>
                <div class="col-sm-8">
                    <div class="input-group">
                        <!--<input type="hidden" select2-spellcasting="character.classObj.spellcasting.bonus"
                               primary="character.classObj.spellcasting.selectedSpells"
                               ui-select2="bonusSelect2Spells" ng-model="character.classObj.spellcasting.bonusSelectedSpells"
                               max="{{character.classObj.spellcasting.bonus.numSpellsKnown}}" style="width:100%" />-->
                        <spell-dialog ng-model="character.classObj.bonusSelectedSpells"></spell-dialog>
                        <ui-select ng-model="character.classObj.bonusSelectedSpells"
                                   multiple
                                   list="classBonusSpells"
                                   max="{{character.classObj.spellcasting.numSpellsKnown}}"
                                   select2-spellcasting="character.classObj.spellcasting.bonus"
                                   theme="select2"
                                   style="width: 100%;">
                            <ui-select-match placeholder="Pick your spells">{{$item.name}}</ui-select-match>
                            <ui-select-choices group-by="'level_desc'"
                                               repeat="spell in $parent.classBonusSpellsFiltered = (classBonusSpells | filterSpells: character.classObj.selectedSpells)
                                                | filter: {name: $select.search} | filterSpells: character.classObj.selectedSpells"
                                               refresh="refreshSpells($select.search)"
                                               refresh-delay="500">
                                <div ng-bind-html="spell.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
        </div>
    </fieldset>
    <fieldset>
        <legend>Abilities</legend>
        <div collapse="!character.classObj.name">
            <table class="table-bordered table-striped table-condensed pull-right">
                <thead>
                <tr>
                    <th>Ability</th>
                    <th>Base</th>
                    <th>Mod</th>
                    <th><abbr title="Saving Throws">ST</abbr></th>
                    <th>Bonus</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td colspan="5">{{character.ability.pointsLeft}} + {{character.ability.bonusPoints - character.ability.bonusPointsLeftArr.length}} Points Left</td>
                </tr>
                <tr>
                    <td>Strength</td>
                    <td class="input-group">
                        <span type="button" class="input-group-addon btn btn-default" ng-click="incrementAbility('str', -1)"><i class="fa fa-minus"></i></span>
                        <input type="text" class="ability form-control text-center" readonly value="{{character.ability.str.score + (bonusAbility.str)}}" />
                        <span class="input-group-addon btn btn-default" ng-click="incrementAbility('str', 1)"><i class="fa fa-plus"></i></span>
                    </td>
                    <td><span ng-show="character.ability.str.mod >= 0">+</span>{{character.ability.str.mod}}</td>
                    <td><span ng-show="character.ability.str.savingThrow >= 0">+</span>{{character.ability.str.savingThrow}}</td>
                    <td>+{{character.ability.str.bonusPoints}}</td>
                </tr>
                <tr>
                    <td>Dexterity</td>
                    <td class="input-group">
                        <span class="input-group-addon btn btn-default" ng-click="incrementAbility('dex', -1)"><i class="fa fa-minus"></i></span>
                        <input type="text" class="ability form-control text-center" readonly value="{{character.ability.dex.score + (bonusAbility.dex)}}" />
                        <span class="input-group-addon btn btn-default" ng-click="incrementAbility('dex', 1)"><i class="fa fa-plus"></i></span>
                    </td>
                    <td><span ng-show="character.ability.dex.mod >= 0">+</span>{{character.ability.dex.mod}}</td>
                    <td><span ng-show="character.ability.dex.savingThrow >= 0">+</span>{{character.ability.dex.savingThrow}}</td>
                    <td>+{{character.ability.dex.bonusPoints}}</td>
                </tr>
                <tr>
                    <td>Constitution</td>
                    <td class="input-group">
                        <span class="input-group-addon btn btn-default" ng-click="incrementAbility('con', -1)"><i class="fa fa-minus"></i></span>
                        <input type="text" class="ability form-control text-center" readonly value="{{character.ability.con.score + (bonusAbility.con)}}" />
                        <span class="input-group-addon btn btn-default" ng-click="incrementAbility('con', 1)"><i class="fa fa-plus"></i></span>
                    </td>
                    <td><span ng-show="character.ability.con.mod >= 0">+</span>{{character.ability.con.mod}}</td>
                    <td><span ng-show="character.ability.con.savingThrow >= 0">+</span>{{character.ability.con.savingThrow}}</td>
                    <td>+{{character.ability.con.bonusPoints}}</td>
                </tr>
                <tr>
                    <td>Intelligence</td>
                    <td class="input-group">
                        <span class="input-group-addon btn btn-default" ng-click="incrementAbility('int', -1)"><i class="fa fa-minus"></i></span>
                        <input type="text" class="ability form-control text-center" readonly value="{{character.ability.int.score + (bonusAbility.int)}}" />
                        <span class="input-group-addon btn btn-default" ng-click="incrementAbility('int', 1)"><i class="fa fa-plus"></i></span>
                    </td>
                    <td><span ng-show="character.ability.int.mod >= 0">+</span>{{character.ability.int.mod}}</td>
                    <td><span ng-show="character.ability.int.savingThrow >= 0">+</span>{{character.ability.int.savingThrow}}</td>
                    <td>+{{character.ability.int.bonusPoints}}</td>
                </tr>
                <tr>
                    <td>Wisdom</td>
                    <td class="input-group">
                        <span class="input-group-addon btn btn-default" ng-click="incrementAbility('wis', -1)"><i class="fa fa-minus"></i></span>
                        <input type="text" class="ability form-control text-center" readonly value="{{character.ability.wis.score + (bonusAbility.wis)}}" />
                        <span class="input-group-addon btn btn-default" ng-click="incrementAbility('wis', 1)"><i class="fa fa-plus"></i></span>
                    </td>
                    <td><span ng-show="character.ability.wis.mod >= 0">+</span>{{character.ability.wis.mod}}</td>
                    <td><span ng-show="character.ability.wis.savingThrow >= 0">+</span>{{character.ability.wis.savingThrow}}</td>
                    <td>+{{character.ability.wis.bonusPoints}}</td>
                </tr>
                <tr>
                    <td>Charisma</td>
                    <td class="input-group">
                        <span class="input-group-addon btn btn-default" ng-click="incrementAbility('cha', -1)"><i class="fa fa-minus"></i></span>
                        <input type="text" class="ability form-control text-center" readonly value="{{character.ability.cha.score + (bonusAbility.cha)}}" />
                        <span class="input-group-addon btn btn-default" ng-click="incrementAbility('cha', 1)"><i class="fa fa-plus"></i></span>
                    </td>
                    <td><span ng-show="character.ability.cha.mod >= 0">+</span>{{character.ability.cha.mod}}</td>
                    <td><span ng-show="character.ability.cha.savingThrow >= 0">+</span>{{character.ability.cha.savingThrow}}</td>
                    <td>+{{character.ability.cha.bonusPoints}}</td>
                </tr>
                </tbody>
                <!--<tfoot>
                    <tr>
                        <td colspan="4">*Recommended</td>
                    </tr>
                </tfoot>-->
            </table>
        </div>
    </fieldset>
    </div> <!-- col-md-6 -->

    <div class="col-md-6" id="charGenCol2">
        <fieldset><!--{{character.proficientSkills}}-->
            <legend>Skills</legend>
            <div collapse="!character.classObj.name">
                <label>Passive Perception:</label> {{character.passivePerception}}
                <div ng-show="character.numSkillsLeft >= 0">{{character.numSkillsLeft + character.raceObj.numSkillChoices - character.bonusSkills.length}} Skills Left</div>
                <skills></skills>
                <div class="form-group" ng-if="character.classObj.expertise">
                    <label class="col-sm-4 control-label">{{character.classObj.expertise.label}}:</label>
                    <div class="col-sm-8">
                        <!--character.classObj.expertise.selectedExpertise-->
                        <ui-select multiple ng-model="selectedExpertise"
                                   expertise
                                   max="{{character.classObj.expertise.numExpertise}}"
                                   theme="select2"
                                   style="width: 100%;">
                            <ui-select-match>{{$item.name}}</ui-select-match>
                            <ui-select-choices repeat="expertise in character.classObj.expertise.list | orderBy: 'name' | filter: $select.search">
                                <div ng-bind-html="expertise.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
        </fieldset>
        <fieldset ng-show="character.classObj.name && (character.numToolChoices > 0 || character.numLanguages > 0)">
            <legend>Proficiencies</legend>
            <div> <!-- collapse="!character.classObj.name"-->
                <div class="form-group" ng-show="character.numToolChoices > 0">
                    <label class="col-sm-4 control-label">Tools:</label>
                    <div class="col-sm-8">
                        <ui-select multiple ng-model="character.selectedTools"
                                   tools
                                   max="{{character.numToolChoices}}"
                                   theme="select2"
                                   style="width: 100%;">
                            <ui-select-match placeholder="Select your tools(s)">{{$item.name}}</ui-select-match>
                            <ui-select-choices repeat="tool in availableTools | filter: {name: $select.search} | filterTools: character">
                                <div ng-bind-html="tool.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
                <div class="form-group" ng-show="character.numLanguages > 0">
                    <label class="col-sm-4 control-label">Languages:</label>
                    <div class="col-sm-8">
                        <ui-select multiple ng-model="character.selectedLanguages"
                                   languages="character.numLanguages"
                                   bonus-languages="character.classObj.bonusLanguages"
                                   max="{{select2Languages}}"
                                   theme="select2"
                                   style="width: 100%;">
                            <ui-select-match placeholder="Select your language(s)">{{$item.name}}</ui-select-match>
                            <ui-select-choices repeat="language in availableLanguages | filter: {name: $select.search}">
                                <div ng-bind-html="language.name | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
        </fieldset>
    </div> <!-- col-md-6 -->
    </div> <!-- panel-body -->
    <div class="panel-footer">
        <form name="charGenForm" ng-submit="saveCharacter()" novalidate>
            <input type="hidden" id="inputName" name="charName" ng-model="character.name" required />
            <input type="hidden" id="inputRace" name="raceName" ng-model="character.raceObj.name" required />
            <input type="hidden" id="inputClass" name="className" ng-model="character.classObj.name" required />
            <input type="hidden" id="inputSubclass" name="subclassName" ng-model="character.classObj.subclassObj.name" ng-required="subclasses.length > 0" />
            <!--<input type="hidden" id="inputFeature" name="featureName" ng-model="selectedFeature.name" ng-required="featureChoices.length > 0" />-->
            <input type="hidden" id="inputBackground" name="backgroundName" ng-model="character.background.name" required />
            <input type="hidden" id="inputLanguage" name="languageName" ng-model="numLanguagesLeft" is-empty />
            <input type="hidden" id="inputSkills" name="skillsName" ng-model="character.numSkillsLeft" is-empty />
            <input type="hidden" id="inputAbPts" name="abPtsLeftName" ng-model="character.ability.pointsLeft" is-empty />
            <!--<input type="text" id="inputAlignment" ng-model="character.alignment" />-->
            <!--<button class="btn btn-primary" ng-click="saveCharacter()" ng-disabled="charGenForm.$invalid">Save Character</button>-->
            <button type="submit" class="btn btn-primary">Save Character</button> <!--ng-disabled="charGenForm.$invalid"-->
            <button type="button" class="btn btn-default" ng-click="openSummary()" ng-if="!isMobile">Open Summary</button>
            <div class="error-container" ng-show="validating && charGenForm.$invalid">
                <div><small class="text-danger" ng-show="charGenForm.charName.$error.required">Please name your character</small></div>
                <div><small class="text-danger" ng-show="charGenForm.raceName.$error.required">Please choose a race</small></div>
                <div><small class="text-danger" ng-show="charGenForm.backgroundName.$error.required">Please choose a background</small></div>
                <div><small class="text-danger" ng-show="charGenForm.languageName.$error.notEmpty">You need to choose your languages</small></div>
                <div><small class="text-danger" ng-show="charGenForm.className.$error.required">Please choose a class</small></div>
                <div><small class="text-danger" ng-show="charGenForm.subclassName.$error.required">Please choose a subclass</small></div>
                <!--<div><small class="text-danger" ng-show="charGenForm.featureName.$error.required">You need to choose a feature for your class</small></div>-->
                <div><small class="text-danger" ng-show="charGenForm.skillsName.$error.notEmpty">Please select your skills</small></div>
                <div><small class="text-danger" ng-show="charGenForm.abPtsLeftName.$error.notEmpty">Please assign your ability scores</small></div>
            </div>
        </form>
    </div>
    </div> <!-- panel -->
    <script type="text/ng-template" id="progressBar.html">
        <!--<div class="modal" id="pleaseWaitDialog" data-backdrop="static" data-keyboard="false">-->
            <div class="modal-header">
                <h4 class="modal-title">Processing...</h4>
            </div>
            <div class="modal-body">
                <progressbar class="progress-striped active" animate="false" value="progress"></progressbar>
            </div>
        <!--</div>-->
    </script>
</div> <!-- ng-app -->